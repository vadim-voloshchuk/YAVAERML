# YAVAYER

## Требования к запуску
Точно работает на версии python - 3.8.10 (просто заметка, на всякий случай).  
Установленный mysql.  
Файл для развёртки БД находится в корне проекта.

## Общая структура
### Структура папок
* common - общие файлы, сейчас тут только функции чтения из файлов с информацией для главной страницы
* fictitious - затычка вместо модуля Вадима
* files - файлы с информацией для главной страницы
* models - модели данных (таблиц) для обращения к БД
* routes - роуты, разбитые на условные blueprint'ы (что-то вроде пространств имён)

### Главные файлы
* [server.py](server.py) - точка входа
* yavayer_dump_yyyy.mm.dd_hh.mm.sql (далее БД может обновляться, и время создания дампа в названии тоже будет меняться)

## Описание роутов
Все основные пересылки данных осуществуляются с помощью json-формата. Файлы передаются в form-data. Остальные ответы с сервера представляют собой просто текст, чтобы понимать, что запрос выполнен корректно. Также просто текст возвращает роут приветственного сообщения.

### Main routes
#### /welcome_message (GET)
Возвращает просто текст начального приветствия интеллектуального помощника для демо-версии.

#### /features_list (GET)
Возвращает список возможностей для главной страницы.  
Формат ответа: {"Заголовок возможности": "Текст с сохранением переводов строк для отображения абзацев", ...}

#### /pricing (GET)
Возвращает расценки тарифов.  
Формат ответа: {"Название тарифного плана":[пункт списка для отображения, ...], ...}

### Auth routes
#### /auth/signup (POST)
Осуществляет создание аккаунта пользователя.  
Посылаемые поля: email, name, password

#### /auth/signin (POST)
Осуществляет вход в лк пользователя.  
Посылаемые поля: email, password, remember (последний пока отправляем пустой строкой)

#### /auth/logout (GET)
Осуществляет выход из лк пользователя.

### Lk routes
#### /lk/get_user_info (GET)
Возращает имя, почту, номер телефона и описание деятельности.  
Получаемые поля: name, email, phone_number, description

#### /lk/edit_user_name (GET + JSON)
Позволяет редактировать имя пользователя.  
Посылаемые поля: name

#### /lk/edit_user_email (GET + JSON)
Позволяет редактировать почту пользователя.  
Посылаемые поля: email

#### /lk/edit_user_phone_number (GET + JSON)
Позволяет редактировать телефонный номер пользователя.  
Посылаемые поля: phone_number

#### /lk/edit_user_description (GET + JSON)
Позволяет редактировать описание деятельности пользователя.  
Посылаемые поля: description

#### /lk/change_password (GET + JSON)
Позволяет пользователю изменять пароль.  
Посылаемые поля: password

#### /lk/get_design_color (GET)
Возращает цвет оформления профиля.  
Получаемые поля: design_color

#### /lk/change_design_color (GET + JSON)
Позволяет менять цвет оформления профиля.  
Посылаемые поля: design_color

#### /lk/get_tariff_plan (GET)
Возращает выбранный тарифный план пользователя.  
Получаемые поля: tariff_plan

#### /lk/choice_of_tariff_plan (GET + JSON)
Позволяет изменять тарифный план.  
Получаемые поля: tariff_plan

#### /lk/delete_account (GET)
Позволяет полностью удалять аккаунт.

### Assistant routes
#### /assistant/upload_template (GET + file in form-data)
Позволяет загружать шаблон в лк. Название шаблона берётся из названия файла.

#### /assistant/download_template (GET)
Позволяет загружать шаблон из лк.  
В ответ приходит файл.

#### /assistant/delete_template (GET + JSON)
Удаляет выбранный шаблон из лк.  
Отправляемые данные: template_name

#### /assistant/add_chat (GET + JSON)
Добавляет новый чат.  
Отправляемые данные: chat_name

#### /assistant/get_chat_names (GET)
Позволяет получить все названия чатов.  
Получаемые данные: chst_names  
Формат данных: {"chat_names": ["название чата", ...]}

#### /assistant/get_messages (GET + JSON)
Позволяет получить определённое количество сообщений из выбранного чата.  
Отправляемые данные: count, chat_name  
Получаемые данные: messages  
Формат получаемых данных: {"messages": [["номер сообщения", "само сообщение", "сообщение юзера?", "название файла"], ...]}  
"сообщение юзера?" прдеставляет собой булево значение, для определения принадлежности сообщения пользователю или системе. "название файла" может быть null, если прикреплённого к сообщению файла нет. На данный момент файл может быть прикреплён только к системным сообщениям.

#### /assistant/send_message (GET + JSON)
Отправляет сообщение и возвращает ответ на него.  
Отправляемые данные: chat_name, message  
Получаемые данные: user_message_number, sys_message_number, answer, file_name
Получение номеров сообщений (отпправляемого сообщения пользователя и получемого ответа системы) необходимо для дальнейшей стыковки данных.

#### /assistant/attach_template (GET + JSON)
Позволяет прикрепить определённый шаблон к выбранному чату.  
Отправляемые данные: template_name, chat_name

#### /assistant/unlink_template (GET + JSON)
Позволяет открепить шаблон от выбранного чата.  
Отправляемые данные: chat_name

#### /assistant/download_file (GET + JSON)
Загружает файл, сгенерированный системой, из лк.
Отправляемые данные: chat_name, message_number  
В ответ приходит файл.
